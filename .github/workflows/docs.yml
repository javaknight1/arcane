name: Documentation

on:
  push:
    branches: [ main, master ]
    paths:
      - 'docs/**'
      - 'README.md'
      - '.github/workflows/docs.yml'

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Pages
      uses: actions/configure-pages@v3

    - name: Create index.html
      run: |
        mkdir -p _site
        cat > _site/index.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>Roadmap Notion Documentation</title>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <style>
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 2rem; }
                .container { max-width: 800px; margin: 0 auto; }
                h1 { color: #333; border-bottom: 2px solid #007acc; padding-bottom: 0.5rem; }
                ul { list-style-type: none; padding: 0; }
                li { margin: 1rem 0; }
                a { color: #007acc; text-decoration: none; font-weight: 500; }
                a:hover { text-decoration: underline; }
                .description { color: #666; font-size: 0.9rem; margin-top: 0.25rem; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>üó∫Ô∏è Roadmap Generator & Notion Importer</h1>
                <p>Documentation for the automated roadmap generation and Notion import tool.</p>

                <h2>üìö Documentation</h2>
                <ul>
                    <li>
                        <a href="README.html">README</a>
                        <div class="description">Main project documentation and quick start guide</div>
                    </li>
                </ul>

                <h2>üîó Links</h2>
                <ul>
                    <li><a href="https://github.com/robavery/roadmap-notion">GitHub Repository</a></li>
                    <li><a href="https://www.notion.so">Notion</a></li>
                    <li><a href="https://claude.ai">Claude AI</a></li>
                </ul>
            </div>
        </body>
        </html>
        EOF

    - name: Convert README to HTML
      run: |
        # Simple markdown to HTML conversion for README
        python3 << 'EOF'
        import re

        with open('README.md', 'r') as f:
            content = f.read()

        # Basic markdown to HTML conversion
        content = re.sub(r'^# (.+)$', r'<h1>\1</h1>', content, flags=re.MULTILINE)
        content = re.sub(r'^## (.+)$', r'<h2>\1</h2>', content, flags=re.MULTILINE)
        content = re.sub(r'^### (.+)$', r'<h3>\1</h3>', content, flags=re.MULTILINE)
        content = re.sub(r'\*\*(.+?)\*\*', r'<strong>\1</strong>', content)
        content = re.sub(r'\*(.+?)\*', r'<em>\1</em>', content)
        content = re.sub(r'```([^`]+)```', r'<pre><code>\1</code></pre>', content, flags=re.DOTALL)
        content = re.sub(r'`([^`]+)`', r'<code>\1</code>', content)
        content = re.sub(r'\[([^\]]+)\]\(([^)]+)\)', r'<a href="\2">\1</a>', content)
        content = content.replace('\n\n', '</p><p>')
        content = f'<p>{content}</p>'

        html = f'''<!DOCTYPE html>
        <html>
        <head>
            <title>Roadmap Notion - README</title>
            <meta charset="utf-8">
            <style>
                body {{ font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 2rem; line-height: 1.6; }}
                .container {{ max-width: 900px; margin: 0 auto; }}
                h1, h2, h3 {{ color: #333; }}
                h1 {{ border-bottom: 2px solid #007acc; padding-bottom: 0.5rem; }}
                pre {{ background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto; }}
                code {{ background: #f6f8fa; padding: 0.2rem 0.4rem; border-radius: 3px; }}
                a {{ color: #007acc; }}
            </style>
        </head>
        <body>
            <div class="container">
                {content}
            </div>
        </body>
        </html>'''

        with open('_site/README.html', 'w') as f:
            f.write(html)
        EOF

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v2

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2